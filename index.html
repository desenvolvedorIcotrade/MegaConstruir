<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META NAME="description" content="ColorLines is a PC-Game, which is a part of the '7 by one stroke' package, written in HTML and JavaScript">
<META NAME="author" content="Lutz Tautenhahn">
<META NAME="keywords" content="Game, ColorLines, Streich, Stroke, JavaScript">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<title>ColorLines</title>
<script language="JavaScript">
var i, j, IsOver, Size=10, dSize=1, NCol=6, NNext=3, Score=0, I_Sel, J_Sel, IsAni;

Fld=new Array(Size);
for (i=0; i<Size; i++)
  Fld[i]=new Array(Size);

Next=new Array(NNext);

Pic=new Array(8);
for (i=0; i<8; i++)
{ Pic[i]=new Image();
  Pic[i].src="ball"+i+"t.gif";
}
PicT=new Array(8);
for (i=0; i<8; i++)
{ PicT[i]=new Image();
  PicT[i].src="ball"+i+".gif";
}
if (! document.layers)
  PicT[0].src="transparent.gif";

function SetColors(nn)
{ NCol=nn; 
  dSize=7-nn; 
  Init();
}

function random(nn)
{ return(Math.round(Math.random()*1000)%nn);
}

function Init()
{ var ii, jj;
  for (ii=0; ii<Size; ii++)
  { for (jj=0; jj<Size; jj++)
    { Fld[ii][jj]=0;
      document.images[jj*Size+ii].src=PicT[0].src;
    }  
  }
  for (ii=dSize; ii<Size-dSize; ii++)
  { for (jj=dSize; jj<Size-dSize; jj++)
    { Fld[ii][jj]=0;
      document.images[jj*Size+ii].src=Pic[0].src;
    }  
  }
  GetNext();
  PutNext();
  GetNext();
  I_Sel=-1;
  IsOver=false;
  IsAni=false;
  Score=0;
  document.forms[0].Score.value=Score;
}

function GetNext()
{ var ii;
  for (ii=0; ii<NNext; ii++)
  { Next[ii]=1+random(NCol);
    document.images[Size*Size+ii].src=Pic[Next[ii]].src;
  }
}

function PutNext()
{ var ii, jj, kk, nn, rr;
  for (kk=0; kk<NNext; kk++)  
  { nn=0;
    for (ii=dSize; ii<Size-dSize; ii++)
    { for (jj=dSize; jj<Size-dSize; jj++)
      { if (Fld[ii][jj]==0) nn++;
      }
    }
    if (nn==0)
    { if (window.opener)
      { if (window.opener.SetHighscores)
        { if (dSize==1) window.opener.SetHighscores("ColorLines","easy",Score,1);
          else window.opener.SetHighscores("ColorLines","hard",Score,1);
        }
      }
      alert("Valeu, você tem "+Score+" pontos !");
      IsOver=true;
      return;
    }
    rr=random(nn)+1;
    nn=0;
    for (ii=dSize; ii<Size-dSize; ii++)
    { for (jj=dSize; jj<Size-dSize; jj++)
      { if (Fld[ii][jj]==0) nn++;
        if (nn==rr)
        { Fld[ii][jj]=Next[kk];
          document.images[jj*Size+ii].src=Pic[Next[kk]].src;
          nn++;
          RemoveTest(ii, jj);
        }
      }
    }
  }
  nn=0;
  for (ii=dSize; ii<Size-dSize; ii++)
  { for (jj=dSize; jj<Size-dSize; jj++)
    { if (Fld[ii][jj]==0) nn++;
    }
  }
  if (nn==0)
  { if (window.opener)
    { if (window.opener.SetHighscores)
      { if (dSize==1) window.opener.SetHighscores("ColorLines","easy",Score,1);
        else window.opener.SetHighscores("ColorLines","hard",Score,1);
      }
    }
    alert("Valeu, você tem "+Score+" pontos !");
    IsOver=true;
  }
}

function Clicked(ii, jj)
{ var nn, mm;
  if (IsOver) return;
  if (IsAni) return;
  if ((ii<dSize)||(ii>Size-dSize-1)||(jj<dSize)||(jj>Size-dSize-1)) return;
  if (I_Sel==-1)
  { if (Fld[ii][jj]>0)
    { I_Sel=ii;
      J_Sel=jj;
      document.images[jj*Size+ii].src=PicT[Fld[ii][jj]].src;
    }
    return;
  }
  if (Fld[ii][jj]>0)
  { document.images[J_Sel*Size+I_Sel].src=Pic[Fld[I_Sel][J_Sel]].src;
    I_Sel=ii;
    J_Sel=jj;
    document.images[jj*Size+ii].src=PicT[Fld[ii][jj]].src;
    return;
  }
  if (GetMoveLine(ii, jj, 1))
  { isAni=true;
    MoveAni(I_Sel, J_Sel);
  }
  else
  { for (nn=0; nn<Size; nn++)
    { for (mm=0; mm<Size; mm++)
      { if (Fld[nn][mm]<0) 
          Fld[nn][mm]=0;
      }
    }
  }
} 

function MoveAni(ii, jj)
{ var nn, mm, vv, vv_best=-1000;
  if (Fld[ii][jj]==-1)
  { for (nn=0; nn<Size; nn++)
    { for (mm=0; mm<Size; mm++)
      { if (Fld[nn][mm]<0) 
          Fld[nn][mm]=0;
      }
    }
    Fld[ii][jj]=Fld[I_Sel][J_Sel];
    Fld[I_Sel][J_Sel]=0;
    vv=RemoveTest(ii, jj);
    IsAni=false;
    if (vv==0)
    { PutNext();
      GetNext();
    }  
    I_Sel=-1; 
    return;
  }
  if (ii>0) 
  { vv=Fld[ii-1][jj];
    if ((vv<0)&&(vv>vv_best)) vv_best=vv;
  }
  if (ii<Size-1) 
  { vv=Fld[ii+1][jj];
    if ((vv<0)&&(vv>vv_best)) vv_best=vv;
  }
  if (jj>0) 
  { vv=Fld[ii][jj-1];
    if ((vv<0)&&(vv>vv_best)) vv_best=vv;
  }
  if (jj<Size-1) 
  { vv=Fld[ii][jj+1];
    if ((vv<0)&&(vv>vv_best)) vv_best=vv;
  }

  if (ii>0) 
  { vv=Fld[ii-1][jj];
    if (vv==vv_best)
    { document.images[jj*Size+ii].src=Pic[0].src;
      document.images[jj*Size+(ii-1)].src=Pic[Fld[I_Sel][J_Sel]].src;
      setTimeout("MoveAni("+eval(ii-1)+","+jj+")",100);
      return;
    }
  }
  if (ii<Size-1) 
  { vv=Fld[ii+1][jj];
    if (vv==vv_best)
    { document.images[jj*Size+ii].src=Pic[0].src;
      document.images[jj*Size+(ii+1)].src=Pic[Fld[I_Sel][J_Sel]].src;
      setTimeout("MoveAni("+eval(ii+1)+","+jj+")",100);
      return;
    }
  }
  if (jj>0) 
  { vv=Fld[ii][jj-1];
    if (vv==vv_best)
    { document.images[jj*Size+ii].src=Pic[0].src;
      document.images[(jj-1)*Size+ii].src=Pic[Fld[I_Sel][J_Sel]].src;
      setTimeout("MoveAni("+ii+","+eval(jj-1)+")",100);
      return;
    }
  }
  if (jj<Size-1) 
  { vv=Fld[ii][jj+1];
    if (vv==vv_best)
    { document.images[jj*Size+ii].src=Pic[0].src;
      document.images[(jj+1)*Size+ii].src=Pic[Fld[I_Sel][J_Sel]].src;
      setTimeout("MoveAni("+ii+","+eval(jj+1)+")",100);
      return;
    }
  }
}

function GetMoveLine(ii, jj, nn)
{ if ((ii==I_Sel)&&(jj==J_Sel)) return(true);
  var vv=Fld[ii][jj];
  if (vv>0) return(false);
  if ((vv<0)&&(-nn<=vv)) return(0);
  vv=false;
  Fld[ii][jj]=-nn;
  if (ii>dSize) { if (GetMoveLine(ii-1, jj, nn+1)) vv=true; }
  if (ii<Size-1-dSize) { if (GetMoveLine(ii+1, jj, nn+1)) vv=true; }
  if (jj>dSize) { if (GetMoveLine(ii, jj-1, nn+1)) vv=true; }
  if (jj<Size-1-dSize) { if (GetMoveLine(ii, jj+1, nn+1)) vv=true; }
  return(vv);
}

function GetFld(ii, jj)
{ if (ii<dSize) return(0);
  if (ii>=Size-dSize) return(0);
  if (jj<dSize) return(0);
  if (jj>=Size-dSize) return(0);
  return(Fld[ii][jj]);
}

function RemoveTest(ii, jj)
{ var ll, ss=0, ccount, ccol=Fld[ii][jj];
  ccount=1;
  ll=0;
  while (GetFld(ii+ll+1, jj)==ccol)
  { ll++;
    ccount++;
  }
  ll=0;
  while (GetFld(ii-ll-1, jj)==ccol)
  { ll++;
    ccount++;
  }
  if (ccount>=5)
  { Fld[ii][jj]=0;
    document.images[jj*Size+ii].src=Pic[0].src;
    ll=0;
    while (GetFld(ii+ll+1, jj)==ccol)
    { Fld[ii+ll+1][jj]=0;
      document.images[jj*Size+ii+ll+1].src=Pic[0].src;
      ll++;
    }
    ll=0;
    while (GetFld(ii-ll-1, jj)==ccol)
    { Fld[ii-ll-1][jj]=0;
      document.images[jj*Size+ii-ll-1].src=Pic[0].src;
      ll++;
    }
    ss+=ccount; 
  }
  
  ccount=1;
  ll=0;
  while (GetFld(ii+ll+1, jj+ll+1)==ccol)
  { ll++;
    ccount++;
  }
  ll=0;
  while (GetFld(ii-ll-1, jj-ll-1)==ccol)
  { ll++;
    ccount++;
  }
  if (ccount>=5)
  { Fld[ii][jj]=0;
    document.images[jj*Size+ii].src=Pic[0].src;
    ll=0;
    while (GetFld(ii+ll+1, jj+ll+1)==ccol)
    { Fld[ii+ll+1][jj+ll+1]=0;
      document.images[(jj+ll+1)*Size+ii+ll+1].src=Pic[0].src;
      ll++;
    }
    ll=0;
    while (GetFld(ii-ll-1, jj-ll-1)==ccol)
    { Fld[ii-ll-1][jj-ll-1]=0;
      document.images[(jj-ll-1)*Size+ii-ll-1].src=Pic[0].src;
      ll++;
    }
    ss+=ccount; 
  }

  ccount=1;
  ll=0;
  while (GetFld(ii, jj+ll+1)==ccol)
  { ll++;
    ccount++;
  }
  ll=0;
  while (GetFld(ii, jj-ll-1)==ccol)
  { ll++;
    ccount++;
  }
  if (ccount>=5)
  { Fld[ii][jj]=0;
    document.images[jj*Size+ii].src=Pic[0].src;
    ll=0;
    while (GetFld(ii, jj+ll+1)==ccol)
    { Fld[ii][jj+ll+1]=0;
      document.images[(jj+ll+1)*Size+ii].src=Pic[0].src;
      ll++;
    }
    ll=0;
    while (GetFld(ii, jj-ll-1)==ccol)
    { Fld[ii][jj-ll-1]=0;
      document.images[(jj-ll-1)*Size+ii].src=Pic[0].src;
      ll++;
    }
    ss+=ccount; 
  }

  ccount=1;
  ll=0;
  while (GetFld(ii+ll+1, jj-ll-1)==ccol)
  { ll++;
    ccount++;
  }
  ll=0;
  while (GetFld(ii-ll-1, jj+ll+1)==ccol)
  { ll++;
    ccount++;
  }
  if (ccount>=5)
  { Fld[ii][jj]=0;
    document.images[jj*Size+ii].src=Pic[0].src;
    ll=0;
    while (GetFld(ii+ll+1, jj-ll-1)==ccol)
    { Fld[ii+ll+1][jj-ll-1]=0;
      document.images[(jj-ll-1)*Size+ii+ll+1].src=Pic[0].src;
      ll++;
    }
    ll=0;
    while (GetFld(ii-ll-1, jj+ll+1)==ccol)
    { Fld[ii-ll-1][jj+ll+1]=0;
      document.images[(jj+ll+1)*Size+ii-ll-1].src=Pic[0].src;
      ll++;
    }
    ss+=ccount; 
  }
  Score+=ss;
  document.forms[0].Score.value=Score;
  return(ss);
}

function Help()
{ alert("Conecte 5 ou mais esferas da mesma cor a uma linha"+
      "\nhorizontal, vertical ou diagonal. Primeirmente estale"+
      "\nsobre uma esfera e depois sobre o destino novo."+ 
      "\nBoa sorte!");
}
</script>
</head>
<BODY bgcolor=#DDBB88>
<form>
<DIV ALIGN=center>
<table noborder><tr><td colspan=3 align=center>
<script language="JavaScript">
document.open("text/plain");
document.writeln("<table border=4 cellpadding=0 cellspacing=1 bgcolor=#cccccc>");
for (j=0; j<Size; j++)
{ document.writeln("<tr align=center>");
  for (i=0; i<Size; i++)
    document.writeln("<td><IMG src=\"ball0.gif\" border=0 onMouseDown=\"Clicked("+i+","+j+")\"></td>");
  document.writeln("</tr>");
}
document.writeln("</table>");
document.close();
</script>
</td></tr>
<tr><td align=center width=33%>
<table noborder>
<tr><td align=center><b>PONTOS:</b></td></tr>
<tr><td align=center><input type=button value="&nbsp;&nbsp;&nbsp;&nbsp;" style="width:36;background-color:#FFFFFF;font-weight:bold" disabled name="Score"></td></tr>
</table>
</td><td align=center width=34%>
<table border=4 cellpadding=0 cellspacing=0 bgcolor=#cccccc><tr>
<td align=center><nobr><b>Em Seguida:</b><br><img src="ball0.gif" border=0><img src="ball0.gif" border=0><img src="ball0.gif" border=0></td>
</tr></table>
</td><td align=center width=33%>
<table noborder>
<tr><td align=center><b>CORES:</b></td></tr>
<tr><td align=center>
<SELECT onChange="SetColors(this.options[selectedIndex].value)" SIZE=1>
<OPTION VALUE=6>6 - Fácil
<OPTION VALUE=7>7 - Difícil
</SELECT>
</td></tr></table>
</td></tr></table>
<table noborder>
<tr><td><input type=button value="Novo Jogo" width=120 style="width:120" onClick="javascript:Init()"></td>
    <td><input type=button value="Ajuda" width=80 style="width:80" onClick="javascript:Help()"></td></tr>
</table>
</DIV>
</form>
<script language="JavaScript">
  Init();
</script>
</BODY>
</HTML>
